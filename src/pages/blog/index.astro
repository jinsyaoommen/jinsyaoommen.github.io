---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Group posts by year
const postsByYear = posts.reduce((acc, post) => {
  const year = post.data.pubDate.getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<Layout title="Reflections | Jinsy Oommen">
  <section class="blog">
    <div class="header">
      <h1>Reflections</h1>
      <p class="intro">Feel free to copy and adapt this. It's the accumulation of years of listening, observing, and learning from the people around me, from seeing both what works and what doesn't. None of this came from one place or one moment. It takes a village to grow wisdom, and this is my small reflection of that shared learning.</p>
    </div>

    <div class="layout">
      <div class="content">
        {years.map((year) => (
          <div class="year-group" id={`year-${year}`}>
            <h2 class="year">{year}</h2>
            <div class="posts">
              {postsByYear[Number(year)].map((post) => (
                <a href={`/blog/${post.id}`} class="post">
                  <span class="date">
                    {post.data.pubDate.toLocaleDateString('en-US', {
                      month: 'long',
                      day: 'numeric',
                    })}
                  </span>
                  <h3>{post.data.title}</h3>
                  <p>{post.data.description}</p>
                  {post.data.tags.length > 0 && (
                    <div class="tags">
                      {post.data.tags.map((tag: string) => (
                        <span class="tag">{tag}</span>
                      ))}
                    </div>
                  )}
                </a>
              ))}
            </div>
          </div>
        ))}

        {posts.length === 0 && (
          <p class="empty">No posts yet. Check back soon!</p>
        )}
      </div>

      <aside class="sidebar">
        <nav class="year-nav">
          <span class="nav-label">Jump to</span>
          {years.map((year) => (
            <a href={`#year-${year}`} class="year-link">{year}</a>
          ))}
        </nav>
      </aside>
    </div>
  </section>
</Layout>

<style>
  .blog {
    padding: 4rem 0;
    min-height: calc(100vh - 64px);
  }

  .header {
    max-width: 1000px;
    margin: 0 auto 2rem;
    padding: 0 2rem;
  }

  h1 {
    font-size: 2.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #2d2d2d;
  }

  .intro {
    font-size: 1rem;
    color: #666;
    font-style: italic;
    max-width: 700px;
  }

  .layout {
    display: flex;
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 2rem;
    gap: 3rem;
  }

  .content {
    flex: 1;
    max-width: 700px;
  }

  .sidebar {
    flex-shrink: 0;
    width: 100px;
  }

  .year-nav {
    position: sticky;
    top: 4rem;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .nav-label {
    font-size: 0.7rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.25rem;
  }

  .year-link {
    font-size: 0.9rem;
    color: #666;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .year-link:hover {
    color: #2d2d2d;
  }

  .year-group {
    margin-bottom: 3rem;
    scroll-margin-top: 2rem;
  }

  .year {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2d2d2d;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e5e5e5;
  }

  .posts {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .post {
    display: block;
    padding: 1.5rem;
    background: #f9f9f9;
    text-decoration: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .post:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }

  .date {
    font-size: 0.75rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .post h3 {
    font-size: 1.25rem;
    font-weight: 500;
    color: #2d2d2d;
    margin: 0.5rem 0;
  }

  .post p {
    font-size: 0.95rem;
    color: #666;
    line-height: 1.6;
    margin: 0;
  }

  .tags {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
    background: #e5e5e5;
    color: #666;
    border-radius: 2px;
  }

  .empty {
    color: #888;
  }

  @media (max-width: 768px) {
    .layout {
      flex-direction: column-reverse;
      gap: 1.5rem;
    }

    .sidebar {
      width: 100%;
    }

    .year-nav {
      position: static;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 0.5rem 1rem;
    }

    .nav-label {
      width: 100%;
    }
  }
</style>
